pipeline {
    agent any

    stages {
        stage('Start ZAP Scan') {
            steps {
                echo 'Starting OWASP ZAP security scan...'
                
                sh '''
				mkdir -p reports || true
                chmod 777 reports
                docker run -v \$(pwd)/reports:/zap/wrk/:rw -t ghcr.io/zaproxy/zaproxy:stable zap-api-scan.py -t http://www.vulnweb.com -r reports/zap-report.html -f openapi || true
                '''
            }
        }
    }

    post {
        always {
            echo 'Publishing ZAP Security Report...'

            publishHTML (target: [
                reportDir: 'reports',
                reportFiles: 'zap-report.html',
                reportName: 'OWASP ZAP Security Report',
                keepAll: true,
                alwaysLinkToLastBuild: true,
                allowMissing: false
            ])
        }
    }
}